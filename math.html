<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>수학 문제 채점</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #result { margin-top: 20px; white-space: pre-line; background: #f8f8f8; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>📷 수학 시험지를 촬영하거나 업로드하세요</h1>

  <form>
    <input type="file" accept="image/*" capture="environment" required>
    <p>※ 시험지를 정면에서 선명하게 촬영해 주세요.</p>
    <button type="submit">채점하기</button>
  </form>

  <div id="result">📊 채점 결과가 여기에 표시됩니다.</div>
  <p><a href="index.html">← 메인으로 돌아가기</a></p>

  <script>
    document.querySelector("form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const file = document.querySelector("input[type=file]").files[0];
      if (!file) return alert("파일을 선택해 주세요.");

      const reader = new FileReader();
      reader.onloadend = async () => {
        const base64 = reader.result.split(',')[1];
        const resultDiv = document.getElementById("result");
        resultDiv.textContent = "채점 중입니다...";

        try {
          const res = await fetch("https://68744ad1-8dba-41d6-9c56-4a5aa4062eb2-00-2w8umvmvho639.sisko.replit.dev/grade", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              image: base64,
              hint: `다음은 3학년 수학 문제의 정답입니다. 학생의 시험지를 보고 문제를 식별한 뒤, 아래 정답과 비교해 오답을 표 형식으로 정리해 주세요.
문제를 계산하지 말고 비교만 하세요.

1: 243 + 326 = 569
2: 428 + 351 = 779
3: 273 + 314 = 587
4: 183 + 402 = 585
5: 527 - 314 = 213
6: 627 - 212 = 415
7: 942 - 457 = 485
8: 184 + 437 = 621`
            })
          });

          const data = await res.json();
          resultDiv.textContent = "📊 채점 결과:\n\n" + (data.result || "결과를 불러오지 못했습니다.");
        } catch (err) {
          resultDiv.textContent = "❌ 오류 발생:\n" + err.message;
        }
      };

      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
